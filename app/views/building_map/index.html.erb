<%=
  map(
    center: {
        # HPI coordinates if no center is set
        latlng: !@target.nil? ? @target.split(",") : [52.39339, 13.13208],
        zoom: 18,
    },
    polygons: BuildingMapHelper.leaflet_polygons(),
    polylines: BuildingMapHelper.leaflet_polylines(@route),
    markers: BuildingMapHelper.leaflet_markers(@route, @target))
%>
<style>
.indoorLabel{
  background: rgba(255, 255, 255, 0);
  border:0;
  border-radius:0px;
  box-shadow: 0 0px 0px;
}
</style>
<script>
  function onEachFeature(feature, layer) {
    layer.bindTooltip(
      feature.properties.name,
      {
          permanent: true,
          direction:'center',
          className: 'indoorLabel',
      }
    );
  }

  fetch('assets/lecture-hall-building.geojson')
    .then(response => response.json())
    .then(geojsonFeature => {
      rooms = L.geoJSON(geojsonFeature, { onEachFeature: onEachFeature }).addTo(map);
      rooms.eachLayer((layer)=>{
        layer.getTooltip().setLatLng(layer.getBounds().getCenter());
      });
      onZoom()
    })
  function onZoom() {
    const zoomLevel = map.getZoom()
    const tooltips = document.getElementsByClassName('indoorLabel')
    const visibility = zoomLevel == 19 /* nearest zoom */ ? 'visible' : 'hidden'
    for (let tooltip of tooltips) {
      tooltip.style.visibility = visibility
    }
  }
  map.on('zoomend', onZoom);
</script>
